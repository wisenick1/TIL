트랜잭션 이해
==
> 출처 : 김영한의 [스프링 DB 1편 - 데이터 접근 핵심 원리](https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-db-1/dashboard)

트랜잭션 ACID
--
- 원자성, 일관성, 격리성, 지속성
- 이 중 격리성 보장이 문제 -> 트랜잭션 격리 수준을 정해야 한다.

세션
--
WAS 등에서 DB와 커넥션을 맺게되면 DB 서버 내에 세션이 생성된다.

이 세션은 트랜잭션을 시작하고, 커밋, 롤백을 통해 트랜잭션을 종료한다.

트랜잭션
--
Commit : 데이터베이스 정상 반영

Rollback : 작업 중 하나라도 실패해서 거래 이전으로 되돌리는 것
- 하나의 세션에서 커밋을 호출하기 전까지는 임시로 데이터를 저장하는 것! -> 다른 세션에 보이지 않는다.
- 트랜잭션 시작 : 수동 커밋 모드로 설정하는 것(H2 -> set autocommit false;)

DB 락
--
- 서로다른 세션에서 동시에 같은 데이터를 수정하면 문제가 생긴다.(원자성 아웃)

세션이 트랜잭션을 시작하고, 해당 row를 update하면 해당 row의 락을 가지게 된다. 

-> 그리고 commit을 해야 락이 풀린다.

-> 그 후 다른 세션에서 해당 row에 대한 락을 획득할 수 있다

- 조회는 일반적으로 락을 사용하지 않는다.

-> 데이터 조회 락 획득 - select for update

> 조회 시점 락 필요한 경우 - 해당 정보로 어떤 계산을 수행할 때, 이 경우에 그 정보가 변경되면 안될 때 사용한다.

트랜잭션 적용(JDBC)
--
트랜잭션을 적용하려면 같은 커넥션을 유지해야 한다

이를 위해 서비스 로직에서 커넥션을 가져와 해당 커넥션을 유지시켜야 하여 서비스 계층이 매우 복잡해진다.