스프링과 문제 해결 - 트랜젝션
==
> 출처 : 김영한의 [스프링 DB 1편 - 데이터 접근 핵심 원리](https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-db-1/dashboard)

앞서 [트랜잭션 이해](https://github.com/wisenick1/TIL/blob/main/spring/%EC%8A%A4%ED%94%84%EB%A7%81%20DB%201%ED%8E%B8%20-%20%EB%8D%B0%EC%9D%B4%ED%84%B0%20%EC%A0%91%EA%B7%BC%20%ED%95%B5%EC%8B%AC%20%EC%9B%90%EB%A6%AC/%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98%20%EC%9D%B4%ED%95%B4.md) 마지막에 말했던 서비스 계층이 JDBC 기술에 의존하고, 복잡했던 문제가 있었다.

트랜잭션 추상화
--
- 서비스 계층이 JDBC 기술에 의존할 경우 다른 기술로 전환할 경우에 엄청난 양의 코드를 고쳐야 한다.

- 이를 위해 스프링에서 PlatformTransactionManger라는 트랜잭션 추상화 인터페이스를 만들어 두었다.
    - getTransaction(), commit(), rollback()

트랜잭션 동기화
--
- 트랜잭션 유지를 위해서는 같은 DB 커넥션을 유지해야 한다.
- 이를 위해 트랜잭션 동기화 매니저 사용
- 트랜잭션 메니저에서 트랜잭션을 시작하면 해당 커넥션을 트랜잭션 동기화 매니저에 보관!
- Repository에서는 DataSourceUtils를 사용해야 트랜잭션 동기화가 가능하다

전체적인 구조
--
서비스에서 트랜잭션 매니저로 트랜잭션을 시작 

-> 트랜잭션 매니저에서 dataSource를 사용해 커넥션을 얻고, 트랜잭션 시작 

-> 커넥션을 트랜잭션 동기화 매니저에 보관 

-> 이 보관된 커넥션을 가져와서 SQL실행 

-> 트랜잭션 종료 시 동기화 매니저에서 커넥션을 가져온다.

-> 커넥션을 통해 DB에 커밋 or 롤백

-> 리소르 정리

같은 패턴 반복, 트랜잭션 코드 존재 해결
--
- 트랜잭션 추상화, 동기화를 해도 같은 패턴이 반복하는 문제와 트랜잭션 코드 존재하는 문제가 남아있다.

- 트랜잭션 템플릿 - 패턴 반복 문제 해결
- 트랙잭션 AOP - 트랜잭션 코드 존재 문제 해결
    - 프록시를 도입하는 것!
    - @Transactional을 사용 - 스프링부트에서 자동적으로 데이터 소스와 트랜잭션 매니저를 등록해준다.


정리
--
- @Transactional을 통해 트랜잭션 추상화, 동기화, 서비스 내부의 코드 문제를 한번에 해결!
- 트랜잭션이 필요한 클래스 혹은 메소드에 @Transactional을 붙여 사용하자